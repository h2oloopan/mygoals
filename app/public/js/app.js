// Generated by CoffeeScript 1.7.1
define(['me', 'ehbs!templates/header', 'ehbs!templates/footer', 'ehbs!templates/index', 'ehbs!templates/login', 'ehbs!templates/signup'], function(me) {
  var app;
  app = {
    start: function() {
      var App;
      App = Ember.Application.create();
      me.attach(App, ['User']);
      App.Router.map(function() {
        this.route('login');
        return this.route('signup');
      });
      App.ApplicationRoute = Ember.Route.extend({
        actions: {
          logout: function() {
            var thiz;
            thiz = this;
            me.auth.logout().then(function() {
              return thiz.controllerFor('application').set('model', {});
            }, function(errors) {
              return false;
            });
            return false;
          }
        }
      });
      App.ApplicationController = Ember.Controller.extend({
        needs: 'index',
        modelBinding: 'controllers.index.model'
      });
      App.IndexRoute = Ember.Route.extend({
        model: function() {
          return me.auth.check();
        }
      });
      App.IndexController = Ember.Controller.extend({});

      /*
      			App.IndexController = Ember.ObjectController.extend
      				needs: 'application'
      				modelBinding: 'controllers.application.model'
       */
      App.LoginRoute = Ember.Route.extend({
        model: function() {
          return this.store.createRecord('user', {});
        },
        actions: {
          login: function() {
            var model, result, thiz;
            thiz = this;
            model = this.controllerFor('login').get('model');
            result = model.validate(['username', 'password']);
            if (!result) {
              return false;
            }
            me.auth.login(model).then(function(user) {
              return thiz.transitionTo('index');
            }, function(errors) {
              return alert(errors);
            });
            return false;
          }
        }
      });
      App.SignupRoute = Ember.Route.extend({
        model: function() {
          return this.store.createRecord('user', {});
        }
      });
      return App.SignupController = Ember.ObjectController.extend({
        actions: {
          signup: function() {
            var result, thiz;
            thiz = this;
            result = this.get('model').validate();
            if (!result) {
              return false;
            }
            if (this.get('confirm') !== this.get('password')) {
              this.set('model.errors.confirm', 'Passwords do not match');
              return false;
            }
            me.auth.signup(this.get('model')).then(function() {
              return thiz.transitionToRoute('login');
            }, function(errors) {
              return alert(errors);
            });
            return false;
          }
        }
      });
    }
  };
  return app;
});
