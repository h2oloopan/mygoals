me = require './mongo-ember'

toSkip = [
	'__v'
]

toSend = null

createModel = (schema) ->
	return ''

createAdapter = (schema) ->
	return ''

createSerializer = (schema) ->
	return (if me.settings.namespace then 'namespace: "' + me.settings.namespace + '"' else '')

createJs = (name, schema) ->
	console.log name
	console.log schema
	js = '
			models["' + name + '"] = DS.Model.extend({
				' + createModel(schema) + '
			});

			adapters["' + name + '"] = DS.RESTAdapter.extend({
				' + createSerializer(schema) + '
			});

			serializers["' + name + '"] = DS.RESTSerializer.extend({
				' + createSerializer(schema) + ' 
			});
		 '
	return js


js = module.exports = 
	addModel: (model) ->
		name = model.modelName
		paths = model.schema.paths
		keys = Object.keys paths
		for key in keys
			if toSkip.indexOf(key) >= 0
				delete paths[key]
			
		js = createJs name, paths
		if toSend?
			toSend += js
		else
			toSend = js
		console.log toSend
		

	middleware: (req, res, next) ->
		next()