// Generated by CoffeeScript 1.7.1
var api, crud, me, mongoose, utils, wrap;

mongoose = require('mongoose');

utils = require('mongoose/lib/utils');

me = require('./mongo-ember');

wrap = function(input, wrapper) {
  var output;
  output = {};
  output[wrapper] = input;
  return output;
};

crud = function(app, url, name) {
  var cname, model;
  model = mongoose.models[name];
  cname = utils.toCollectionName(name);
  app.get(url, function(req, res) {
    return model.find({}, function(err, result) {
      if (err) {
        return res.send(500, err.message);
      } else {
        return res.send(200, wrap(result, cname));
      }
    });
  });
  return app.get(url + '/:id', function(req, res) {
    var id;
    id = req.params.id;
    return model.findById(id, function(err, result) {
      if (err) {
        return res.send(500, err.message);
      } else {
        return res.send(200, wrap(result, name));
      }
    });
  });
};

api = module.exports = {
  bind: function(app) {
    var cname, model, models, name, root, url;
    root = '/' + (me.settings.namespace || '');
    models = mongoose.models;
    for (name in models) {
      model = models[name];
      cname = utils.toCollectionName(name);
      url = root + '/' + cname;
      crud(app, url, name);
    }
  }
};
