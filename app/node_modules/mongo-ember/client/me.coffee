define [], () ->
	#to use this, make sure Ember-Data and jQuery are already available
	me = 
		version: '{{version}}'
		models: '{{models}}'
		validators:
			required: (value) ->
				return if (value == null || value == undefined) then false else true
			match: (value, parameters) ->
				regExp = parameters[0]
				return null != value && if '' != value then regExp.test value else true

		notify: ->
			alert 'Hello World!'
		attach: (App, names) ->
			for name in names
				App[name] = DS.Model.extend @models[name].model
				App[name + 'Adapter'] = DS.RESTAdapter.extend @models[name].adapter
				App[name + 'Serializer'] = DS.RESTSerializer.extend @models[name].serializer
				#validation
				App[name].reopen
					errors: {}
					validate: ->
						validations = @models[name].validations
						for path of validations
							type = validations[path].type
							parameters = validations[path].parameters
							message = validations[path].message
							validator = @validators[type]
							result = validator @get(path), parameters
							if !result then @errors[path] = message
						return


			return
		auth:
			signup: (user) ->
				url = '{{url_signup}}'
				data = JSON.stringify
					user: user.toJSON()
				return new Ember.RSVP.Promise (resolve, reject) ->
					$.ajax
						type: 'POST'
						contentType: 'application/json; charset=utf-8'
						url: url
						data: data
						dataType: 'json'
					.done (data) ->
						resolve data
					.fail (data) ->
						reject data.responseText
				#this returns a promise

			login: (user) ->
				url = '{{url_login}}'
				if typeof user.toJSON == 'function' then user = user.toJSON()
				return $.post url,
					user: user
				#this returns a promise
				
			check: ->
				url = '{{url_check}}'
				return new Ember.RSVP.Promise (resolve, reject) ->
					$.get(url).done (data) ->
						resolve data
					.fail (data) ->
						resolve null
	return me