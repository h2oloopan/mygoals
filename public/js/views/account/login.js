// Generated by CoffeeScript 1.6.2
define(['text!templates/account/login.html', 'models/user'], function(template, User) {
  var LoginView;

  return LoginView = Backbone.View.extend({
    el: $('#content'),
    events: {
      'click .btn-login': 'login'
    },
    initialize: function() {
      return this.model = new User();
    },
    render: function() {
      this.$el.html(template);
      this.info();
      if (this.options.from === 'signup') {
        return this.info('<strong>Congratulations!</strong>\nYou have signed up successfully.\nYou can now log in with your new account.');
      }
    },
    login: function(e) {
      var form, view;

      this.model.clear();
      this.error();
      form = this.$('form').serializeObject();
      this.model.set(form, {
        validate: true
      });
      if (!this.model.isValid()) {
        this.error(this.model.validationError);
        return false;
      }
      view = this;
      $.post('/api/account/login', this.model.toJSON()).done(function() {
        return window.location.href = '/';
      }).fail(function(fb) {
        return view.error(fb.responseText);
      });
      return false;
    },
    error: function(msg) {
      if (msg != null) {
        this.$('.warning-text').html(msg);
        return this.$('.warning-msg').show();
      } else {
        return this.$('.warning-msg').hide();
      }
    },
    info: function(msg) {
      if (msg != null) {
        this.$('.info-msg').html(msg);
        return this.$('.info-msg').show();
      } else {
        return this.$('.info-msg').hide();
      }
    }
  });
});
