// Generated by CoffeeScript 1.6.3
(function() {
  define(['utils', 'text!templates/account/login.html', 'models/user'], function(utils, template, User) {
    var LoginView;
    return LoginView = Backbone.View.extend({
      el: $('#content'),
      events: {
        'click .btn-login': 'login'
      },
      render: function() {
        this.$el.html(template);
        this.info();
        if (this.options.from === 'signup') {
          return this.info('<strong>Congratulations!</strong>\nYou have signed up successfully.\nYou can now log in with your new account.');
        }
      },
      login: function(e) {
        var form, user, view;
        this.error();
        form = utils.serialize(this.$('form'));
        user = new User();
        user.set(form, {
          validate: true
        });
        if (!user.isValid()) {
          this.error(user.validationError);
          return false;
        }
        view = this;
        utils.login(user.toJSON(), function(err) {
          if (err != null) {
            return view.error(err);
          } else {
            return utils.navigate('dashboard');
          }
        });
        return false;
      },
      error: function(msg) {
        if (msg != null) {
          this.$('.warning-text').html(msg);
          return this.$('.warning-msg').show();
        } else {
          return this.$('.warning-msg').hide();
        }
      },
      info: function(msg) {
        if (msg != null) {
          this.$('.info-msg').html(msg);
          return this.$('.info-msg').show();
        } else {
          return this.$('.info-msg').hide();
        }
      }
    });
  });

}).call(this);
