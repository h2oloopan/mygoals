// Generated by CoffeeScript 1.6.2
define(['text!templates/account/signup.html', 'models/user'], function(template, User) {
  var SignupView;

  return SignupView = Backbone.View.extend({
    el: $('#content'),
    events: {
      'click .btn-signup': 'signup'
    },
    initialize: function() {
      this.model = new User();
      this.model.urlRoot = '/api/account/signup';
      return this.model.on('invalid', function(model, err) {
        return this.error(err);
      }, this);
    },
    render: function() {
      return this.$el.html(template);
    },
    signup: function(e) {
      var form, view;

      this.model.clear();
      this.error();
      form = this.$('form').serializeObject();
      if (form.password !== form.confirm) {
        this.error('Passwords do not match');
        return false;
      }
      if (form.agree == null) {
        this.error('You must agree to terms of service and privacy policy');
        return false;
      }
      view = this;
      this.model.save(form, {
        success: function(model, response) {
          return view.options.router.navigate('login?from=signup', {
            trigger: true
          });
        },
        error: function(model, response) {
          return view.error(response.responseText);
        }
      });
      return false;
    },
    error: function(msg) {
      if (msg != null) {
        this.$('.warning-text').html(msg);
        return this.$('.warning-msg').show();
      } else {
        return this.$('.warning-msg').hide();
      }
    }
  });
});
